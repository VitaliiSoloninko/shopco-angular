<div class="image-upload">
  <label class="image-upload__label">{{ label() }}</label>

  <!-- Upload Area -->
  <div
    class="image-upload__area"
    [class.image-upload__area--drag-over]="isDragOver"
    [class.image-upload__area--has-file]="selectedFile"
    [class.image-upload__area--error]="shouldShowErrors"
    (dragover)="onDragOver($event)"
    (dragleave)="onDragLeave($event)"
    (drop)="onDrop($event)"
  >
    <!-- Preview Section -->
    @if (previewUrl && selectedFile) {
    <div class="image-upload__preview">
      <img
        [src]="previewUrl"
        [alt]="selectedFile.name"
        class="image-upload__preview-image"
      />
      <div class="image-upload__file-info">
        <div class="image-upload__file-name">{{ selectedFile.name }}</div>
        <div class="image-upload__file-size">
          {{ (selectedFile.size / 1024 / 1024).toFixed(2) }} MB
        </div>
      </div>
      <button
        type="button"
        class="image-upload__remove-btn"
        (click)="removeFile()"
        aria-label="Remove image"
      >
        Ã—
      </button>
    </div>
    }

    <!-- Upload Prompt -->
    @if (!selectedFile) {
    <div class="image-upload__prompt">
      <div class="image-upload__icon">
        <svg
          width="48"
          height="48"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
        >
          <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
          <polyline points="7,10 12,15 17,10" />
          <line x1="12" y1="15" x2="12" y2="3" />
        </svg>
      </div>
      <div class="image-upload__text">
        <div class="image-upload__primary-text">
          Drag and drop an image here, or
          <label class="image-upload__browse-btn">
            browse
            <input
              type="file"
              class="image-upload__input"
              [accept]="acceptAttribute"
              (change)="onFileSelect($event)"
            />
          </label>
        </div>
        <div class="image-upload__secondary-text">
          Supports: {{ acceptedFormats().join(", ").toUpperCase() }} up to
          {{ maxSizeInMB() }}MB
        </div>
      </div>
    </div>
    }

    <!-- Hidden file input for click upload when file exists -->
    @if (selectedFile) {
    <input
      type="file"
      class="image-upload__input image-upload__input--hidden"
      [accept]="acceptAttribute"
      (change)="onFileSelect($event)"
    />
    <button
      type="button"
      class="image-upload__change-btn"
      onclick="this.previousElementSibling.click()"
    >
      Change Image
    </button>
    }
  </div>

  <!-- Error Messages -->
  @if (shouldShowErrors) {
  <div class="image-upload__errors">
    @for (error of errors; track error.type) {
    <div class="image-upload__error">{{ error.message }}</div>
    }
  </div>
  }
</div>
